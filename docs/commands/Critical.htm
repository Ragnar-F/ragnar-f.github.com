<!DOCTYPE HTML>
<html>
<head>
<title>Critical</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link href="../static/theme.css" rel="stylesheet" type="text/css" />
<script src="../static/jquery.js" type="text/javascript"></script>
<script src="../static/tree.jquery.js" type="text/javascript"></script>
<script src="../static/ga.js" type="text/javascript"></script>
<script src="../static/content.js" type="text/javascript"></script>
</head>
<body>

<h1>Critical</h1>

<p>Verhindert, dass der <a href="../misc/Threads.htm">aktuelle Thread</a> von anderen Threads unterbrochen wird.</p>

<pre class="Syntax">Critical [, Off]
Critical 50 <em>; Siehe <a href="#Interval">Bemerkungen</a>.</em></pre>
<p>Wenn der erste Parameter nicht vorhanden (oder "On") ist, wird der <a href="../misc/Threads.htm">aktuelle Thread</a> kritisch gemacht. Das heißt, dass dieser Thread nicht von anderen Threads unterbrochen werden kann. Enthält der erste Parameter das Wort Off (oder 0 seit v1.0.48), wird der aktuelle Thread sofort unterbrechbar, unabhängig von den Einstellungen in <a href="Thread.htm">Thread Interrupt</a>.</p>
<p>Im Gegensatz zu <a href="../misc/Threads.htm">hoch-priorisierten</a> Threads werden Ereignisse während eines kritischen Threads nicht verworfen. Drückt der Benutzer beispielsweise einen <a href="../Hotkeys.htm">Hotkey</a>, während der aktuelle Thread kritisch ist, wird dieser Hotkey auf unbestimmte Zeit zwischengespeichert, bis der aktuelle Thread endet oder unkritisch gemacht wird. Dabei wird der Hotkey als neuer Thread ausgeführt.</p>
<p>In Notfällen wird ein kritischer Thread unterbrochen. Notfälle sind: 1) <a href="OnExit.htm">OnExit</a>-Subroutine; 2) <a href="OnMessage.htm">OnMessage()</a>-Funktion, die eine Nachrichtennummer kleiner als 0x312 überwacht (oder ein <a href="RegisterCallback.htm">Callback</a>, der von so einer Nachricht ausgelöst wird); und 3) <a href="RegisterCallback.htm">Callback</a>, der indirekt vom kritischen Thread selbst ausgelöst wird (z. B. mittels <a href="PostMessage.htm">SendMessage</a> oder <a href="DllCall.htm">DllCall</a>). Um diese Unterbrechungen zu vermeiden, sollten solche Funktionen vorübergehend deaktiviert werden.</p>
<p>Bei zwischengespeicherten Ereignissen, die darauf warten, neue Threads zu starten, führt "Critical Off" nicht zu einer sofortigen Unterbrechung des aktuellen Threads. Stattdessen wird dieser Thread erst nach durchschnittlich 5 ms unterbrochen. Daher ist es zu mehr als 99,999 % wahrscheinlich, dass mindestens eine Zeile nach "Critical Off" ausgeführt wird, bevor eine Unterbrechung erfolgt. Unterbrechungen können sofort mithilfe einer Verzögerung wie <code><a href="Sleep.htm">Sleep -1</a></code> oder <a href="WinWait.htm">WinWait</a> erzwungen werden.</p>
<p>Ein kritischer Thread wird unterbrechbar, sobald eine <a href="MsgBox.htm">MsgBox</a> oder ein anderes Dialogfenster angezeigt wird. Im Gegensatz zu <a href="Thread.htm">Thread Interrupt</a> wird der Thread allerdings wieder kritisch, wenn der Benutzer das Dialogfenster schließt.</p>
<p>Siehe <a href="../Variables.htm#IsCritical">A_IsCritical</a> für Informationen, wie die aktuelle Einstellung von Critical gespeichert oder wiederhergestellt werden kann. Da Critical jedoch eine thread-spezifische Einstellung ist, wird der darunterliegende/fortgesetzte Thread (sofern vorhanden) automatisch unkritisch, wenn ein kritischer Thread endet. Folglich gibt es keinen Grund, "Critical Off" ans Ende eines Threads zu setzen.</p>
<p>Solange Critical nicht im automatischen Ausführungsbereich (oberster Teil des Scripts) verwendet wird, starten alle Threads unkritisch (obwohl die Einstellungen von <a href="Thread.htm">Thread Interrupt</a> noch gelten). Aktiviert der automatische Ausführungsbereich hingegen Critical, wird jeder neu gestartete <a href="../misc/Threads.htm">Thread</a> (z. B. <a href="../Hotkeys.htm">Hotkey</a>, <a href="Menu.htm">benutzerdefinierter Menüpunkt</a> oder <a href="SetTimer.htm">zeitgesteuerte</a> Subroutine) von Beginn an kritisch sein.</p>
<p>Der Befehl <a href="Thread.htm">Thread NoTimers</a> ist vergleichbar mit Critical, außer dass dieser nur Unterbrechungen von <a href="SetTimer.htm">Timern</a> verhindern kann.</p>
<p>Seit v1.0.47 führt die Aktivierung von Critical dazu, dass <a href="SetBatchLines.htm"><code>SetBatchLines -1</code></a> für den <a href="../misc/Threads.htm">aktuellen Thread</a> wirksam wird.</p>
<p><a name="Interval"></a>Seit v1.0.47 führt die Angabe einer positiven Zahl im ersten Parameter (z. B. <code>Critical 30</code>) dazu, dass Critical aktiviert wird, sowie auch die Überprüfungsdauer in Millisekunden der internen Nachrichtenwarteschlange geändert wird. Falls nichts angegeben ist, werden die Nachrichten bei aktiviertem Critical alle 16 ms und bei deaktiviertem Critical alle 5 ms überprüft. Die Erhöhung des Intervalls führt auch dazu, dass der Empfang von Nachrichten/Ereignisse nach hinten verschoben wird, wodurch der <a href="../misc/Threads.htm">aktuelle Thread</a> mehr Zeit hat, zu enden. Das verringert die Wahrscheinlichkeit, dass bestimmte <a href="OnMessage.htm">OnMessage()</a>- und <a href="Gui.htm#DefaultWin">GUI-Ereignisse</a> aufgrund von "Thread wird bereits ausgeführt" verloren gehen. Wartende Befehle wie <a href="Sleep.htm">Sleep</a> und <a href="WinWait.htm">WinWait</a> werden Nachrichten unabhängig dieser Einstellung überprüfen (als Übergangslösung kann <code>DllCall("Sleep", UInt, 500)</code> verwendet werden). Hinweis: Ist der Nachrichtenüberprüfungsintervall zu hoch, könnte die Reaktionsfähigkeit von verschiedenen Ereignissen reduziert werden (z. B. beim Neuzeichnen eines <a href="Gui.htm">GUI</a>-Fensters).</p>
<h3>Siehe auch</h3>
<p><a href="Thread.htm">Thread (Befehl)</a>, <a href="../misc/Threads.htm">Threads</a>, <a href="_MaxThreadsPerHotkey.htm">#MaxThreadsPerHotkey</a>, <a href="_MaxThreadsBuffer.htm">#MaxThreadsBuffer</a>, <a href="OnMessage.htm">OnMessage()</a>, <a href="RegisterCallback.htm">RegisterCallback()</a>, <a href="Hotkey.htm">Hotkey</a>, <a href="Menu.htm">Menu</a>, <a href="SetTimer.htm">SetTimer</a></p>
<h3>Beispiel</h3>
<pre class="NoIndent">#space::  <em>; Hotkey: WIN+LEERTASTE</em>
Critical
ToolTip Es wird kein neuer Thread gestartet, solange dieser ToolTip nicht verschwindet.
Sleep 3000
ToolTip  <em>; ToolTip ausschalten.</em>
return  <em>; Beendet den Thread. Jeder darunterliegende Thread ist laut Definition unkritisch.</em></pre>

</body>
</html>
